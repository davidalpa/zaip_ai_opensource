# name: Deploy Supabase Edge Functions

# on:
#   push:
#     branches:
#       - main        # Adjust if your branch is not main
#   workflow_dispatch:

# jobs:
#   deploy:
#     runs-on: ubuntu-latest
#     env:
#       SUPABASE_ACCESS_TOKEN: ${{ secrets.SUPABASE_ACCESS_TOKEN }} # Configure this secret in your repository.
#       SUPABASE_PROJECT_ID: ${{ secrets.SUPABASE_PROJECT_ID }} # Configure this secret in your repository.

#     steps:
#       - name: Checkout repo
#         uses: actions/checkout@v4

#       - name: Setup Supabase CLI
#         uses: supabase/setup-cli@v1
#         with:
#           version: latest

#       - name: Deploy ALL Edge Functions
#         run: supabase functions deploy --project-ref $SUPABASE_PROJECT_ID

#       # - name: Refresh Knowledge Base (RAG)
#       #   run: |
#       #     echo "Waiting for propagation..."
#       #     sleep 10
#       #     echo "Triggering Knowledge Base Refresh..."
#       #     curl -X POST "https://${{ secrets.SUPABASE_PROJECT_ID }}.supabase.co/functions/v1/mcp" \
#       #       -H "Authorization: Bearer ${{ secrets.MCP_TOKEN }}" \
#       #       -H "Content-Type: application/json" \
#       #       -d '{"jsonrpc": "2.0", "method": "call", "id": "gh-action-refresh", "params": { "name": "admin_refresh_knowledge" }}'
